<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>d20 Roll</title>
<style>
  :root { --red:#e02424; --bg:#000; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--red);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .stage{position:relative;width:100%;height:100%;overflow:hidden;display:grid;place-items:center}
  .result{position:absolute;inset:auto 0 10vh 0;text-align:center;font-weight:900;font-size:min(22vmin,180px);letter-spacing:.02em;pointer-events:none;text-shadow:0 0 24px rgba(224,36,36,.35)}
  .hint{position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);opacity:.7}
  /* Die container that we animate */
  .dieWrap{position:absolute;top:55%;left:-20vmin;width:min(22vmin,160px);height:min(22vmin,160px);display:grid;place-items:center;filter:drop-shadow(0 0 14px rgba(224,36,36,.4))}
  .rolling{animation: roll 1.8s cubic-bezier(.2,.7,.2,1) forwards}
  @keyframes roll{
    0%{ transform: translateX(0) rotate(0deg) translateY(0) }
    70%{ transform: translateX(110vw) rotate(900deg) translateY(-3vmin) }
    100%{ transform: translateX(120vw) rotate(1080deg) translateY(0) }
  }
  /* Built-in SVG styling */
  svg{width:100%;height:100%}
  .d20{stroke:var(--red);fill:#0a0a0a;stroke-width:2}
  .facet{fill:#120000}
  .edge{stroke:var(--red);stroke-opacity:.65}
  /* Button */
  .btn{position:absolute;top:1rem;right:1rem;background:transparent;border:2px solid var(--red);color:var(--red);
       padding:.5rem 1rem;border-radius:999px;cursor:pointer}
  .btn:active{transform:translateY(1px)}
</style>
</head>
<body>
  <div class="stage" id="stage" aria-live="polite">
    <button class="btn" id="rollBtn">Roll d20</button>

    <!-- Animated die (tries die.png first, otherwise uses inline SVG) -->
    <div class="dieWrap" id="dieWrap" aria-hidden="true">
      <img id="dieImg" alt="d20" style="display:none;width:100%;height:100%;object-fit:contain;image-rendering:crisp-edges" src="die.png">
      <!-- fallback SVG: stylized d20 (wireframe with facets) -->
      <svg id="dieSvg" viewBox="-52 -52 104 104" role="img" aria-label="d20">
        <g class="d20">
          <!-- rough icosahedron-ish look: outer, inner, edges -->
          <polygon class="facet" points="0,-48 28,-38 45,-12 36,22 8,46 -8,46 -36,22 -45,-12 -28,-38 0,-48"/>
          <g class="edge" fill="none">
            <polygon points="0,-48 28,-38 45,-12 36,22 8,46 -8,46 -36,22 -45,-12 -28,-38 0,-48"/>
            <path d="M0,-48 L0,8 M28,-38 L0,8 M-28,-38 L0,8 M45,-12 L-8,46 M-45,-12 L8,46 M36,22 L-36,22"/>
          </g>
        </g>
      </svg>
    </div>

    <div class="result" id="result">—</div>
    <div class="hint" id="hint">Tap / click / press R to roll</div>
  </div>

<script>
  const dieWrap = document.getElementById('dieWrap');
  const dieImg = document.getElementById('dieImg');
  const dieSvg = document.getElementById('dieSvg');
  const resultEl = document.getElementById('result');
  const btn = document.getElementById('rollBtn');

  // Try to use die.png if present; else fallback to SVG
  dieImg.addEventListener('load', ()=>{ dieImg.style.display='block'; dieSvg.style.display='none'; });
  dieImg.addEventListener('error', ()=>{ dieImg.style.display='none'; dieSvg.style.display='block'; });

  function rand20(){ return Math.floor(Math.random()*20)+1; }

  let spinning=false, flickerTimer=null;
  function roll(){
    if(spinning) return;
    spinning = true;
    resultEl.textContent = '…';

    // restart animation
    dieWrap.classList.remove('rolling');
    // force reflow to restart keyframes
    void dieWrap.offsetWidth;
    dieWrap.classList.add('rolling');

    // number flicker during roll
    const start = performance.now();
    const dur = 1800;
    let last = 0;

    function tick(t){
      const elapsed = t - start;
      const p = Math.min(elapsed/dur,1);
      // faster at start, slower near end
      const interval = 40 + 260 * p*p;
      if(!tick.last || (t - tick.last) > interval){
        let n = rand20(); if(n===last) n = (n%20)+1; last=n;
        resultEl.textContent = n;
        tick.last = t;
      }
      if(p<1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    // settle result at end
    setTimeout(()=>{
      const final = rand20();
      resultEl.textContent = final;
      spinning = false;
    }, dur);
  }

  window.addEventListener('load', ()=>{
    // probe die.png
    if (!dieImg.complete) dieImg.src = 'die.png'; // trigger
    roll();
  });

  btn.addEventListener('click', roll);
  document.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='r') roll(); });
  document.getElementById('stage').addEventListener('click', e=>{
    if(e.target.closest('#rollBtn')) return;
    roll();
  }, {passive:true});
</script>
</body>
</html>
